<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="500" height="1000" style="border:1px solid black">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>

/****************************
 *
 * Global Variables
 *
 ****************************/
var WIDTH_PX = 500;
var HEIGHT_PX = 1000;
var WIDTH_FT = 10;
var HEIGHT_FT = 20;
var NUM_VERT_GRIDS = WIDTH_FT * 2;
var NUM_HORIZ_GRIDS = HEIGHT_FT * 2;

var vehicle =
{
   x: 0,
   y: 75,
   width: 100,
   height: 50,
   borderWidth: 5
};

/*
 * define the runAnimation boolean as an object
 * so that it can be modified by reference
 */
var runAnimation = {
  value: false
};

/****************************
 *
 * Functions
 *
 ****************************/
function drawGridlines()
{
   //draw horizontal grid-lines
   for(var i = 0; i < NUM_VERT_GRIDS; i++)
   {
      ctx.moveTo(i*(WIDTH_PX/NUM_VERT_GRIDS),0);
      ctx.lineTo(i*(WIDTH_PX/NUM_VERT_GRIDS),HEIGHT_PX);
      ctx.stroke();
   }

   //draw vertical grid-lines
   for(var i = 0; i < NUM_HORIZ_GRIDS; i++)
   {
      ctx.moveTo(0,i*(HEIGHT_PX/NUM_HORIZ_GRIDS));
      ctx.lineTo(WIDTH_PX, i*(HEIGHT_PX/NUM_HORIZ_GRIDS),WIDTH_PX);
      ctx.stroke();
   }

   var c = document.getElementById("myCanvas");
   var ctx = c.getContext("2d");
   ctx.beginPath();
   ctx.arc(95,50,40,0,2*Math.PI);
   ctx.stroke();
}

window.requestAnimFrame = (function(callback) {
   return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
   function(callback) {
      window.setTimeout(callback, 1000 / 60);
   };
})();

function drawRect(myRectangle, context) 
{
   context.beginPath();
   context.rect(myRectangle.x, myRectangle.y, myRectangle.width, myRectangle.height);
   context.fillStyle = '#8ED6FF';
   context.fill();
   context.lineWidth = myRectangle.borderWidth;
   context.strokeStyle = 'black';
   context.stroke();
}

function animate(lastTime, myRectangle, runAnimation, canvas, context) 
{
   if(runAnimation.value) 
   {
      // update
      var time = (new Date()).getTime();
      var timeDiff = time - lastTime;

      // pixels / second
      var linearSpeed = 100;
      var linearDistEachFrame = linearSpeed * timeDiff / 1000;
      var currentX = myRectangle.x;

      if(currentX < canvas.width - myRectangle.width - myRectangle.borderWidth / 2) 
      {
         var newX = currentX + linearDistEachFrame;
         myRectangle.x = newX;
      }

      // clear
      context.clearRect(0, 0, canvas.width, canvas.height);

      // draw
      drawRect(myRectangle, context);

      // request new frame
      requestAnimFrame(function() 
      {
         animate(time, myRectangle, runAnimation, canvas, context);
      });
   }
}

/****************************
 *
 * Main
 *
 ****************************/
 
var canvas=document.getElementById("myCanvas");
var context=canvas.getContext("2d");
drawRectangle(vehicle, context);
 
</script>

</body>
</html>
